<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuiz Seronok untuk Seorang atau Berdua</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
        }

        body {
            text-align: center;
            overflow-x: hidden;
        }

        /* Landing Page Styles */
        #landing-page {
            background: linear-gradient(135deg, #ffeb3b, #ff9800);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .landing-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .landing-header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            color: #d81b60;
            text-shadow: 2px 2px #fff;
            animation: bounce 2s infinite;
            margin-bottom: 20px;
        }

        .landing-header p {
            font-size: clamp(1rem, 3vw, 1.5rem);
            margin: 20px 0;
            color: #fff;
        }

        .cta-button {
            background-color: #4caf50;
            color: white;
            padding: 15px 30px;
            font-size: clamp(1rem, 3vw, 1.5rem);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin: 10px;
        }

        .cta-button:hover {
            background-color: #388e3c;
            transform: scale(1.1);
        }

        .features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .feature-box {
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            width: clamp(200px, 30%, 300px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .feature-box:hover {
            transform: scale(1.1);
        }

        .feature-box:active {
            transform: scale(1.05);
        }

        .feature-box img {
            width: 60px;
            margin-bottom: 10px;
        }

        .feature-box h3 {
            font-size: clamp(1rem, 2vw, 1.2rem);
            color: #d81b60;
        }

        .landing-footer {
            margin-top: 40px;
            font-size: clamp(0.8rem, 2vw, 1rem);
            color: #fff;
        }

        /* Popup for Laugh Together */
        #laugh-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffeb3b;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            font-size: clamp(1rem, 3vw, 1.5rem);
            color: #d81b60;
            animation: fadeIn 0.5s ease-in-out;
            z-index: 1000;
        }

        /* Intro Page Styles */
        #intro-page {
            display: none;
            background: linear-gradient(135deg, #ff4081, #3f51b5);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
        }

        .intro-container {
            max-width: 600px;
            padding: 20px;
        }

        .intro-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            color: #ffeb3b;
            text-shadow: 3px 3px #d81b60;
            animation: bounce 2s infinite;
            margin-bottom: 20px;
        }

        .intro-subtitle {
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: #fff;
            text-shadow: 2px 2px #4caf50;
            animation: fadeIn 2s ease-in-out;
            margin-bottom: 30px;
        }

        .intro-button {
            background-color: #4caf50;
            color: white;
            padding: 15px 30px;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .intro-button:hover {
            background-color: #388e3c;
            transform: scale(1.1);
        }

        /* Mode Selection Page Styles */
        #mode-page {
            display: none;
            background: linear-gradient(135deg, #2196f3, #4caf50);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
        }

        .mode-container {
            max-width: 600px;
            padding: 20px;
        }

        .mode-title {
            font-size: clamp(2rem, 5vw, 3rem);
            color: #ffeb3b;
            text-shadow: 2px 2px #d81b60;
            margin-bottom: 20px;
        }

        .mode-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .mode-button {
            background-color: #d81b60;
            color: white;
            padding: 15px 30px;
            font-size: clamp(1rem, 3vw, 1.5rem);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .mode-button:hover {
            background-color: #b0003a;
            transform: scale(1.1);
        }

        /* Avatar Selection Page Styles */
        #avatar-page {
            display: none;
            background: linear-gradient(135deg, #ff9800, #ff4081);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
        }

        .avatar-container {
            max-width: 600px;
            padding: 20px;
        }

        .avatar-title {
            font-size: clamp(2rem, 5vw, 3rem);
            color: #ffeb3b;
            text-shadow: 2px 2px #d81b60;
            margin-bottom: 20px;
        }

        .avatar-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .avatar-option {
            background: #fff;
            padding: 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: clamp(2rem, 5vw, 3rem);
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .avatar-option:hover {
            transform: scale(1.2);
        }

        .avatar-option.selected {
            background-color: #4caf50;
            color: #fff;
        }

        /* Room Selection Page Styles */
        #room-page {
            display: none;
            background: linear-gradient(135deg, #3f51b5, #2196f3);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
        }

        .room-container {
            max-width: 600px;
            padding: 20px;
        }

        .room-title {
            font-size: clamp(2rem, 5vw, 3rem);
            color: #ffeb3b;
            text-shadow: 2px 2px #d81b60;
            margin-bottom: 20px;
        }

        .room-input {
            padding: 10px;
            font-size: clamp(1rem, 3vw, 1.5rem);
            border-radius: 10px;
            border: none;
            margin: 10px;
            width: clamp(200px, 80%, 400px);
        }

        .room-button {
            background-color: #4caf50;
            color: white;
            padding: 15px 30px;
            font-size: clamp(1rem, 3vw, 1.5rem);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin: 10px;
        }

        .room-button:hover {
            background-color: #388e3c;
            transform: scale(1.1);
        }

        /* Quiz Page Styles */
        #quiz-page {
            display: none;
            background: linear-gradient(135deg, #4caf50, #2196f3);
            min-height: 100vh;
            padding: 20px;
        }

        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .quiz-container h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: #d81b60;
            margin-bottom: 20px;
        }

        #question {
            font-size: clamp(1rem, 3vw, 1.5rem);
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .question-icon {
            font-size: clamp(2rem, 5vw, 3rem);
            animation: bounce 2s infinite;
        }

        .player-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .player-box {
            width: clamp(200px, 45%, 400px);
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .player-box h3 {
            font-size: clamp(1rem, 2vw, 1.2rem);
            color: #d81b60;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-avatar {
            font-size: clamp(1.5rem, 3vw, 2rem);
            animation: bounce 2s infinite;
        }

        #solo-options {
            margin-top: 20px;
        }

        .solo-avatar {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .option {
            background-color: #ffeb3b;
            color: #333;
            padding: 10px;
            margin: 5px 0;
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: block;
            width: 100%;
        }

        .option:hover {
            background-color: #fbc02d;
            transform: scale(1.05);
        }

        .option:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #feedback {
            font-size: clamp(1rem, 3vw, 1.5rem);
            margin: 20px 0;
            display: none;
            padding: 20px;
            border-radius: 15px;
            animation: popIn 0.5s ease-in-out;
        }

        #countdown {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: #d81b60;
            margin: 20px 0;
            display: none;
            animation: pulse 1s infinite;
        }

        #result {
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: #d81b60;
            margin-top: 20px;
            display: none;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .back-button, .home-button {
            background-color: #2196f3;
            color: white;
            padding: 10px 20px;
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .back-button:hover, .home-button:hover {
            background-color: #1976d2;
            transform: scale(1.1);
        }

        /* Congrats Page Styles */
        #congrats-page {
            display: none;
            background: linear-gradient(135deg, #ffeb3b, #4caf50);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .congrats-container {
            max-width: 600px;
            padding: 20px;
            text-align: center;
        }

        .congrats-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            color: #d81b60;
            text-shadow: 2px 2px #fff;
            animation: bounce 2s infinite;
            margin-bottom: 20px;
        }

        .congrats-message {
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: #fff;
            margin-bottom: 30px;
        }

        .next-quiz-button {
            background-color: #2196f3;
            color: white;
            padding: 15px 30px;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin: 10px;
        }

        .next-quiz-button:hover {
            background-color: #1976d2;
            transform: scale(1.1);
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* General Animations */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-20px);
            }
            60% {
                transform: translateY(-10px);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .player-section {
                flex-direction: column;
                align-items: center;
            }

            .player-box {
                width: 100%;
            }

            .mode-buttons, .avatar-options, .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .cta-button, .intro-button, .mode-button, .avatar-option, .room-button, .next-quiz-button, .back-button, .home-button {
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landing-page">
        <div class="landing-container">
            <div class="landing-header">
                <h1>Kuiz Seronok untuk Seorang atau Berdua!</h1>
                <p>Pilih avatar, main sendiri atau bersama kawan di mana saja, ketawa dengan soalan lucu! ðŸ˜„</p>
                <button class="cta-button" onclick="showIntro()">Mulakan Kuiz Sekarang!</button>
            </div>

            <div class="features">
                <div class="feature-box" onclick="showAvatarSelection('solo')">
                    <img src="https://img.icons8.com/color/48/000000/user.png" alt="Seorang">
                    <h3>Main Seorang</h3>
                    <p>Jadi juara dengan avatar pilihan kamu!</p>
                </div>
                <div class="feature-box" onclick="showAvatarSelection('multi')">
                    <img src="https://img.icons8.com/color/48/000000/two-hearts.png" alt="Berdua">
                    <h3>Main Berdua</h3>
                    <p>Ajak kawan, main sama-sama di telefon berbeza!</p>
                </div>
                <div class="feature-box" onclick="laughTogether()">
                    <img src="https://img.icons8.com/color/48/000000/smiling.png" alt="Senyum">
                    <h3>Ketawa Bersama</h3>
                    <p>Soalan dengan ikon lucu, bunyi seronok!</p>
                </div>
            </div>

            <div class="landing-footer">
                <p>Â© 2025 Kuiz Kanak-Kanak. Jom main dan menang!</p>
            </div>
        </div>
    </div>

    <!-- Laugh Together Popup -->
    <div id="laugh-popup">Jom ketawa bersama kawan! ðŸ˜„</div>

    <!-- Intro Page -->
    <div id="intro-page">
        <div class="intro-container">
            <h1 class="intro-title">Kuiz Seronok untuk Kanak-Kanak!</h1>
            <p class="intro-subtitle">Sedia untuk berseronok? Pilih cara main kamu! ðŸ˜„</p>
            <button class="intro-button" onclick="showModeSelection()">Mula Sekarang!</button>
        </div>
    </div>

    <!-- Mode Selection Page -->
    <div id="mode-page">
        <div class="mode-container">
            <h1 class="mode-title">Pilih Cara Main!</h1>
            <div class="mode-buttons">
                <button class="mode-button" onclick="showAvatarSelection('solo')">Main Seorang</button>
                <button class="mode-button" onclick="showAvatarSelection('multi')">Main Berdua</button>
            </div>
        </div>
    </div>

    <!-- Avatar Selection Page -->
    <div id="avatar-page">
        <div class="avatar-container">
            <h1 class="avatar-title" id="avatar-title">Pilih Avatar Kamu!</h1>
            <div class="avatar-options" id="avatar-options"></div>
            <button class="cta-button" onclick="confirmAvatar()">Seterusnya</button>
        </div>
    </div>

    <!-- Room Selection Page -->
    <div id="room-page">
        <div class="room-container">
            <h1 class="room-title">Main Berdua Rentas Peranti</h1>
            <p>Masukkan kod bilik untuk menyertai kawan, atau cipta bilik baru!</p>
            <input type="text" id="room-code" class="room-input" placeholder="Masukkan Kod Bilik">
            <button class="room-button" onclick="joinRoom()">Sertai Bilik</button>
            <button class="room-button" onclick="createRoom()">Cipta Bilik Baru</button>
        </div>
    </div>

    <!-- Quiz Page -->
    <div id="quiz-page">
        <div class="quiz-container">
            <h1>Kuiz Seronok Kanak-Kanak!</h1>
            <div id="solo-avatar" class="solo-avatar"></div>
            <div id="question"></div>
            <div class="player-section" id="player-section">
                <div class="player-box" id="player1-box">
                    <h3 id="player1-header">Pemain 1 (Skor: <span id="player1-score">0</span>)</h3>
                    <div id="player1-options"></div>
                </div>
                <div class="player-box" id="player2-box">
                    <h3 id="player2-header">Pemain 2 (Skor: <span id="player2-score">0</span>)</h3>
                    <div id="player2-options"></div>
                </div>
            </div>
            <div id="solo-options"></div>
            <div id="feedback"></div>
            <div id="countdown"></div>
            <div id="result"></div>
            <div class="nav-buttons">
                <button class="back-button" onclick="goBack()">Kembali</button>
                <button class="home-button" onclick="goHome()">Menu Utama</button>
            </div>
        </div>
    </div>

    <!-- Congrats Page -->
    <div id="congrats-page">
        <canvas id="confetti-canvas"></canvas>
        <div class="congrats-container">
            <h1 class="congrats-title" id="congrats-title">Tahniah! 10/10!</h1>
            <p class="congrats-message" id="congrats-message">Kamu hebat! Semua soalan betul! ðŸŽ‰ Nak main tahap seterusnya?</p>
            <button class="next-quiz-button" id="next-level-btn">Main Tahap Seterusnya!</button>
            <button class="home-button" onclick="goHome()">Menu Utama</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js"></script>

    <script>
        // Firebase Configuration (Ganti dengan konfigurasi anda)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Audio Files (Ganti dengan URL sebenar atau hoskan fail)
        const correctSound = new Audio('https://www.soundjay.com/buttons/sounds/button-09.mp3');
        const wrongSound = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3');
        const cheerSound = new Audio('https://www.soundjay.com/human/sounds/applause-01.mp3');
        const laughSound = new Audio('https://www.soundjay.com/human/sounds/laugh-01.mp3');

        // Quiz Data with Icons
        const quizData = {
            1: [
                { question: "Apa warna langit pada hari cerah?", options: ["Merah", "Biru", "Hijau", "Kuning"], answer: "Biru", icon: "â˜ï¸" },
                { question: "Berapa kaki seekor kucing?", options: ["Dua", "Tiga", "Empat", "Lima"], answer: "Empat", icon: "ðŸ±" },
                { question: "Buah yang selalu jadi penutup?", options: ["Epal", "Pisang", "Tomato", "Anggur"], answer: "Tomato", icon: "ðŸ…" },
                { question: "Haiwan yang paling genit?", options: ["Semute", "Semute gatal", "Semute api", "Semute manja"], answer: "Semute manja", icon: "ðŸœ" },
                { question: "Apa nama planet tempat kita tinggal?", options: ["Marikh", "Bumi", "Musytari", "Zuhrah"], answer: "Bumi", icon: "ðŸŒ" },
                { question: "Bunga yang paling cantik?", options: ["Mawar", "Melati", "Orkid", "Matahari"], answer: "Mawar", icon: "ðŸŒ¹" },
                { question: "Berapa bilangan roda pada basikal?", options: ["Satu", "Dua", "Tiga", "Empat"], answer: "Dua", icon: "ðŸš²" },
                { question: "Haiwan yang paling pendiam?", options: ["Gajah", "Semute", "Singa", "Burung"], answer: "Semute", icon: "ðŸ˜" },
                { question: "Apa yang selalu ada di hujung pelangi?", options: ["Emas", "Pelangi lain", "Awan", "Matahari"], answer: "Emas", icon: "ðŸŒˆ" },
                { question: "Alat untuk menulis di papan putih?", options: ["Pensel", "Pen", "Kapur", "Penanda"], answer: "Kapur", icon: "âœï¸" }
            ],
            2: [
                { question: "Haiwan yang paling besar di dunia?", options: ["Gajah", "Paus biru", "Badak", "Zirafah"], answer: "Paus biru", icon: "ðŸ³" },
                { question: "Apa warna daun pada musim panas?", options: ["Merah", "Kuning", "Hijau", "Oren"], answer: "Hijau", icon: "ðŸƒ" },
                { question: "Berapa jari di satu tangan manusia?", options: ["Tiga", "Empat", "Lima", "Enam"], answer: "Lima", icon: "âœ‹" },
                { question: "Buah yang paling manis?", options: ["Lemon", "Mangga", "Cili", "Betik"], answer: "Mangga", icon: "ðŸ¥­" },
                { question: "Apa yang terbang tanpa sayap?", options: ["Burung", "Masa", "Kapal terbang", "Helikopter"], answer: "Masa", icon: "â³" },
                { question: "Haiwan yang paling pantas berlari?", options: ["Kucing", "Cita", "Anjing", "Kuda"], answer: "Cita", icon: "ðŸ†" },
                { question: "Apa nama bulan pertama dalam setahun?", options: ["Mac", "Januari", "Julai", "Disember"], answer: "Januari", icon: "ðŸ“…" },
                { question: "Alat muzik yang dimainkan dengan tiup?", options: ["Gitar", "Piano", "Seruling", "Dram"], answer: "Seruling", icon: "ðŸŽ¶" },
                { question: "Apa yang selalu basah walaupun kering?", options: ["Baju", "Tuala", "Air", "Kertas"], answer: "Tuala", icon: "ðŸ§´" },
                { question: "Sayuran yang berwarna ungu?", options: ["Kobis ungu", "Bayam", "Kacang", "Timun"], answer: "Kobis ungu", icon: "ðŸ¥¬" }
            ],
            3: [
                { question: "Apa nama bendera Malaysia?", options: ["Jalur Gemilang", "Bunga Raya", "Harimau Malaya", "Sang Saka"], answer: "Jalur Gemilang", icon: "ðŸ‡²ðŸ‡¾" },
                { question: "Berapa kaki seekor labah-labah?", options: ["Empat", "Lapan", "Enam", "Sepuluh"], answer: "Lapan", icon: "ðŸ•·ï¸" },
                { question: "Buah yang dikenali sebagai 'Raja Buah'?", options: ["Durian", "Rambutan", "Manggis", "Nanas"], answer: "Durian", icon: "ðŸˆ" },
                { question: "Haiwan yang suka makan buluh?", options: ["Panda", "Koala", "Beruang", "Harimau"], answer: "Panda", icon: "ðŸ¼" },
                { question: "Apa warna bunga kebangsaan Malaysia?", options: ["Kuning", "Merah", "Putih", "Ungu"], answer: "Merah", icon: "ðŸŒº" },
                { question: "Berapa hari dalam seminggu?", options: ["Lima", "Enam", "Tujuh", "Lapan"], answer: "Tujuh", icon: "ðŸ“†" },
                { question: "Alat untuk mengukur panjang?", options: ["Pembaris", "Termometer", "Jam", "Timbang"], answer: "Pembaris", icon: "ðŸ“" },
                { question: "Haiwan yang paling tinggi?", options: ["Gajah", "Zirafah", "Kuda", "Unta"], answer: "Zirafah", icon: "ðŸ¦’" },
                { question: "Apa yang kita gunakan untuk melihat bintang di langit?", options: ["Mikroskop", "Teleskop", "Kamera", "Kaca mata"], answer: "Teleskop", icon: "ðŸ”­" },
                { question: "Sayuran yang digunakan dalam nasi goreng?", options: ["Kubis", "Brokoli", "Lobak merah", "Zukini"], answer: "Lobak merah", icon: "ðŸ¥•" }
            ],
            4: [
                { question: "Apa ibu kota Malaysia?", options: ["Kuala Lumpur", "Johor Bahru", "Penang", "Melaka"], answer: "Kuala Lumpur", icon: "ðŸ™ï¸" },
                { question: "Berapa ekor kaki pada lebah?", options: ["Empat", "Lima", "Enam", "Tujuh"], answer: "Enam", icon: "ðŸ" },
                { question: "Buah yang berwarna kuning dan panjang?", options: ["Pisang", "Nanas", "Mangga", "Betik"], answer: "Pisang", icon: "ðŸŒ" },
                { question: "Haiwan yang tinggal di dalam air dan bernafas dengan insang?", options: ["Katak", "Ikan", "Buaya", "Penyu"], answer: "Ikan", icon: "ðŸ " },
                { question: "Apa warna awan pada hari hujan?", options: ["Putih", "Kelabu", "Biru", "Kuning"], answer: "Kelabu", icon: "â˜ï¸" },
                { question: "Berapa sisi pada segi tiga?", options: ["Dua", "Tiga", "Empat", "Lima"], answer: "Tiga", icon: "ðŸ”º" },
                { question: "Alat muzik yang mempunyai tali?", options: ["Gitar", "Dram", "Seruling", "Piano"], answer: "Gitar", icon: "ðŸŽ¸" },
                { question: "Haiwan yang terkenal dengan belangnya?", options: ["Harimau", "Zebra", "Singa", "Cita"], answer: "Zebra", icon: "ðŸ¦“" },
                { question: "Apa yang kita gunakan untuk melindungi kepala dari hujan?", options: ["Payung", "Topi", "Selendang", "Jaket"], answer: "Payung", icon: "â˜‚ï¸" },
                { question: "Sayuran yang sering dijadikan sup?", options: ["Bayam", "Kentang", "Kacang panjang", "Terung"], answer: "Kentang", icon: "ðŸ¥”" }
            ],
            5: [
                { question: "Apa nama gunung tertinggi di Malaysia?", options: ["Gunung Kinabalu", "Gunung Tahan", "Gunung Ledang", "Gunung Jerai"], answer: "Gunung Kinabalu", icon: "â›°ï¸" },
                { question: "Berapa kaki pada kumbang?", options: ["Empat", "Lima", "Enam", "Lapan"], answer: "Enam", icon: "ðŸž" },
                { question: "Buah yang dikenali sebagai 'ratu buah'?", options: ["Manggis", "Durian", "Rambutan", "Cempedak"], answer: "Manggis", icon: "ðŸ‡" },
                { question: "Haiwan yang boleh menukar warna kulit?", options: ["Katak", "Sotong", "Bunglon", "Ular"], answer: "Bunglon", icon: "ðŸ¦Ž" },
                { question: "Apa warna bunga matahari?", options: ["Merah", "Kuning", "Biru", "Ungu"], answer: "Kuning", icon: "ðŸŒ»" },
                { question: "Berapa sisi pada segi empat sama?", options: ["Tiga", "Empat", "Lima", "Enam"], answer: "Empat", icon: "ðŸ”²" },
                { question: "Alat untuk mengira masa?", options: ["Pembaris", "Jam", "Termometer", "Timbang"], answer: "Jam", icon: "â°" },
                { question: "Haiwan yang terkenal kerana tidur lama?", options: ["Beruang", "Kucing", "Anjing", "Arnab"], answer: "Beruang", icon: "ðŸ»" },
                { question: "Apa yang kita gunakan untuk menyalakan lampu?", options: ["Suis", "Bateri", "Kabel", "Plag"], answer: "Suis", icon: "ðŸ’¡" },
                { question: "Sayuran yang berbentuk seperti bunga?", options: ["Kubis", "Brokoli", "Sawi", "Kacang"], answer: "Brokoli", icon: "ðŸ¥¦" }
            ],
            6: [
                { question: "Apa nama pulau terbesar di Malaysia?", options: ["Pulau Pinang", "Pulau Langkawi", "Pulau Borneo", "Pulau Tioman"], answer: "Pulau Borneo", icon: "ðŸï¸" },
                { question: "Berapa sayap pada burung?", options: ["Satu", "Dua", "Tiga", "Empat"], answer: "Dua", icon: "ðŸ¦" },
                { question: "Buah yang selalu ada dalam kuih tradisional?", options: ["Kelapa", "Epal", "Oren", "Anggur"], answer: "Kelapa", icon: "ðŸ¥¥" },
                { question: "Haiwan yang suka melompat di pokok?", options: ["Monyet", "Harimau", "Gajah", "Badak"], answer: "Monyet", icon: "ðŸ’" },
                { question: "Apa warna darah manusia?", options: ["Biru", "Merah", "Hijau", "Kuning"], answer: "Merah", icon: "ðŸ©º" },
                { question: "Berapa sisi pada bulatan?", options: ["Sifar", "Satu", "Dua", "Tiga"], answer: "Sifar", icon: "âšª" },
                { question: "Alat muzik yang dimainkan dengan pukul?", options: ["Seruling", "Dram", "Gitar", "Piano"], answer: "Dram", icon: "ðŸ¥" },
                { question: "Haiwan yang paling kuat di hutan?", options: ["Singa", "Gajah", "Badak", "Beruang"], answer: "Gajah", icon: "ðŸ˜" },
                { question: "Apa yang kita gunakan untuk menjahit pakaian?", options: ["Jarum", "Gunting", "Pita", "Kertas"], answer: "Jarum", icon: "ðŸª¡" },
                { question: "Sayuran yang selalu ada dalam salad?", options: ["Timun", "Sawi", "Labu", "Peria"], answer: "Timun", icon: "ðŸ¥’" }
            ],
            7: [
                { question: "Apa nama sungai terpanjang di Malaysia?", options: ["Sungai Rajang", "Sungai Kinabatangan", "Sungai Pahang", "Sungai Perak"], answer: "Sungai Rajang", icon: "ðŸŒŠ" },
                { question: "Berapa kaki pada lipas?", options: ["Empat", "Lima", "Enam", "Lapan"], answer: "Enam", icon: "ðŸª³" },
                { question: "Buah yang selalu dimakan dengan kulitnya?", options: ["Anggur", "Nanas", "Betik", "Durian"], answer: "Anggur", icon: "ðŸ‡" },
                { question: "Haiwan yang terkenal kerana berenang perlahan?", options: ["Penyu", "Ikan lumba-lumba", "Jerung", "Paus"], answer: "Penyu", icon: "ðŸ¢" },
                { question: "Apa warna bulan pada waktu malam?", options: ["Kuning", "Merah", "Hijau", "Biru"], answer: "Kuning", icon: "ðŸŒ™" },
                { question: "Berapa sisi pada segi lapan?", options: ["Lima", "Enam", "Tujuh", "Lapan"], answer: "Lapan", icon: "ðŸ”¶" },
                { question: "Alat untuk menimbang berat?", options: ["Pembaris", "Termometer", "Timbang", "Jam"], answer: "Timbang", icon: "âš–ï¸" },
                { question: "Haiwan yang suka makan madu?", options: ["Beruang", "Semute", "Lebah", "Harimau"], answer: "Beruang", icon: "ðŸ¯" },
                { question: "Apa yang kita gunakan untuk melindungi tangan semasa memasak?", options: ["Sarung tangan", "Apron", "Topi", "Kain"], answer: "Sarung tangan", icon: "ðŸ§¤" },
                { question: "Sayuran yang selalu digunakan dalam sate?", options: ["Bawang", "Kubis", "Sawi", "Kacang"], answer: "Bawang", icon: "ðŸ§…" }
            ],
            8: [
                { question: "Apa nama tarian tradisional Malaysia?", options: ["Joget", "Bharatanatyam", "Lion Dance", "Kathak"], answer: "Joget", icon: "ðŸ’ƒ" },
                { question: "Berapa sayap pada rama-rama?", options: ["Dua", "Empat", "Enam", "Lapan"], answer: "Empat", icon: "ðŸ¦‹" },
                { question: "Buah yang selalu ada dalam jam?", options: ["Epal", "Nanas", "Strawberi", "Betik"], answer: "Strawberi", icon: "ðŸ“" },
                { question: "Haiwan yang terkenal kerana ekor panjangnya?", options: ["Monyet", "Kucing", "Tupai", "Burung"], answer: "Monyet", icon: "ðŸ’" },
                { question: "Apa warna matahari pada waktu pagi?", options: ["Merah", "Kuning", "Biru", "Hijau"], answer: "Kuning", icon: "â˜€ï¸" },
                { question: "Berapa sisi pada segi lima?", options: ["Tiga", "Empat", "Lima", "Enam"], answer: "Lima", icon: "ðŸ”¶" },
                { question: "Alat muzik yang dimainkan dengan petik?", options: ["Piano", "Ukulele", "Dram", "Seruling"], answer: "Ukulele", icon: "ðŸŽ¸" },
                { question: "Haiwan yang suka tidur terbalik?", options: ["Kelawar", "Kucing", "Anjing", "Burung"], answer: "Kelawar", icon: "ðŸ¦‡" },
                { question: "Apa yang kita gunakan untuk menyapu lantai?", options: ["Berus", "Penyapu", "Kain", "Span"], answer: "Penyapu", icon: "ðŸ§¹" },
                { question: "Sayuran yang berwarna oren?", options: ["Lobak merah", "Bayam", "Kubis", "Sawi"], answer: "Lobak merah", icon: "ðŸ¥•" }
            ],
            9: [
                { question: "Apa nama kuih tradisional Malaysia?", options: ["Kuih Lapis", "Pizza", "Donut", "Croissant"], answer: "Kuih Lapis", icon: "ðŸ°" },
                { question: "Berapa kaki pada katak?", options: ["Dua", "Tiga", "Empat", "Lima"], answer: "Empat", icon: "ðŸ¸" },
                { question: "Buah yang selalu ada dalam air sirap?", options: ["Laici", "Durian", "Nanas", "Betik"], answer: "Laici", icon: "ðŸˆ" },
                { question: "Haiwan yang terkenal kerana paruhnya?", options: ["Burung", "Kucing", "Anjing", "Arnab"], answer: "Burung", icon: "ðŸ¦" },
                { question: "Apa warna bintang di langit malam?", options: ["Merah", "Kuning", "Hijau", "Biru"], answer: "Kuning", icon: "â­" },
                { question: "Berapa sisi pada segi enam?", options: ["Empat", "Lima", "Enam", "Tujuh"], answer: "Enam", icon: "ðŸ”·" },
                { question: "Alat untuk memotong kertas?", options: ["Gunting", "Pembaris", "Pen", "Berus"], answer: "Gunting", icon: "âœ‚ï¸" },
                { question: "Haiwan yang paling genit di laut?", options: ["Ikan", "Sotong", "Ubur-ubur", "Penyu"], answer: "Ubur-ubur", icon: "ðŸª¼" },
                { question: "Apa yang kita gunakan untuk melindungi badan dari hujan?", options: ["Jaket", "Payung", "Topi", "Baju hujan"], answer: "Baju hujan", icon: "ðŸ§¥" },
                { question: "Sayuran yang selalu ada dalam tomyam?", options: ["Bawang", "Kubis", "Cendawan", "Sawi"], answer: "Cendawan", icon: "ðŸ„" }
            ],
            10: [
                { question: "Apa nama haiwan kebangsaan Malaysia?", options: ["Harimau", "Gajah", "Badak", "Orang Utan"], answer: "Harimau", icon: "ðŸ…" },
                { question: "Berapa sayap pada lebah?", options: ["Dua", "Empat", "Enam", "Lapan"], answer: "Empat", icon: "ðŸ" },
                { question: "Buah yang terkenal di Terengganu?", options: ["Nanas", "Rambutan", "Cempedak", "Durian"], answer: "Rambutan", icon: "ðŸ‘" },
                { question: "Haiwan yang terkenal kerana tanduknya?", options: ["Badak", "Kambing", "Rusa", "Kerbau"], answer: "Badak", icon: "ðŸ¦" },
                { question: "Apa warna laut pada hari cerah?", options: ["Merah", "Kuning", "Biru", "Hijau"], answer: "Biru", icon: "ðŸŒŠ" },
                { question: "Berapa sisi pada segi tujuh?", options: ["Lima", "Enam", "Tujuh", "Lapan"], answer: "Tujuh", icon: "ðŸ”¶" },
                { question: "Alat muzik yang dimainkan dengan tekan?", options: ["Piano", "Gitar", "Dram", "Seruling"], answer: "Piano", icon: "ðŸŽ¹" },
                { question: "Haiwan yang suka makan rumput?", options: ["Kambing", "Harimau", "Singa", "Ular"], answer: "Kambing", icon: "ðŸ" },
                { question: "Apa yang kita gunakan untuk menutup tingkap?", options: ["Langsir", "Kain", "Kertas", "Papan"], answer: "Langsir", icon: "ðŸªŸ" },
                { question: "Sayuran yang selalu dimakan mentah?", options: ["Kubis", "Kentang", "Brokoli", "Labu"], answer: "Kubis", icon: "ðŸ¥¬" }
            ]
        };

        let currentQuiz = 1;
        let currentQuestions = quizData[1];
        let currentQuestion = 0;
        let player1Score = 0;
        let player2Score = 0;
        let player1Answer = null;
        let player2Answer = null;
        let gameMode = 'solo';
        let player1Avatar = '';
        let player2Avatar = '';
        let currentPlayer = 1;
        let roomId = null;
        let isOnlineMulti = false;

        // Navigation Functions
        function showIntro() {
            document.getElementById('landing-page').style.display = 'flex';
            document.getElementById('intro-page').style.display = 'none';
            document.getElementById('mode-page').style.display = 'none';
            document.getElementById('avatar-page').style.display = 'none';
            document.getElementById('room-page').style.display = 'none';
            document.getElementById('quiz-page').style.display = 'none';
            document.getElementById('congrats-page').style.display = 'none';
            document.getElementById('laugh-popup').style.display = 'none';
        }

        function showModeSelection() {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('intro-page').style.display = 'none';
            document.getElementById('mode-page').style.display = 'flex';
            document.getElementById('avatar-page').style.display = 'none';
            document.getElementById('room-page').style.display = 'none';
            document.getElementById('quiz-page').style.display = 'none';
            document.getElementById('congrats-page').style.display = 'none';
            document.getElementById('laugh-popup').style.display = 'none';
        }

        function showAvatarSelection(mode) {
            gameMode = mode;
            currentPlayer = 1;
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('intro-page').style.display = 'none';
            document.getElementById('mode-page').style.display = 'none';
            document.getElementById('avatar-page').style.display = 'flex';
            document.getElementById('room-page').style.display = 'none';
            document.getElementById('quiz-page').style.display = 'none';
            document.getElementById('congrats-page').style.display = 'none';
            document.getElementById('laugh-popup').style.display = 'none';

            const avatarTitle = document.getElementById('avatar-title');
            avatarTitle.innerText = mode === 'solo' ? 'Pilih Avatar Kamu!' : `Pilih Avatar Pemain ${currentPlayer}!`;

            const avatarOptions = document.getElementById('avatar-options');
            avatarOptions.innerHTML = '';
            const avatars = ['ðŸ¶', 'ðŸ±', 'ðŸ»', 'ðŸ°', 'ðŸ¦', 'ðŸ¸'];
            avatars.forEach(avatar => {
                const div = document.createElement('div');
                div.className = 'avatar-option';
                div.innerText = avatar;
                div.onclick = () => selectAvatar(avatar);
                avatarOptions.appendChild(div);
            });
        }

        function selectAvatar(avatar) {
            const options = document.querySelectorAll('.avatar-option');
            options.forEach(opt => opt.classList.remove('selected'));
            event.target.classList.add('selected');
            if (gameMode === 'solo') {
                player1Avatar = avatar;
            } else {
                if (currentPlayer === 1) {
                    player1Avatar = avatar;
                } else {
                    player2Avatar = avatar;
                }
            }
        }

        function confirmAvatar() {
            if (gameMode === 'solo') {
                startQuiz(1, 'solo');
            } else {
                if (currentPlayer === 1) {
                    currentPlayer = 2;
                    document.getElementById('avatar-title').innerText = 'Pilih Avatar Pemain 2!';
                    document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                } else {
                    showRoomSelection();
                }
            }
        }

        function showRoomSelection() {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('intro-page').style.display = 'none';
            document.getElementById('mode-page').style.display = 'none';
            document.getElementById('avatar-page').style.display = 'none';
            document.getElementById('room-page').style.display = 'flex';
            document.getElementById('quiz-page').style.display = 'none';
            document.getElementById('congrats-page').style.display = 'none';
            document.getElementById('laugh-popup').style.display = 'none';
        }

        function laughTogether() {
            const popup = document.getElementById('laugh-popup');
            popup.style.display = 'block';
            laughSound.play();
            setTimeout(() => {
                popup.style.display = 'none';
            }, 2000);
        }

        function createRoom() {
            roomId = Math.random().toString(36).substr(2, 6);
            database.ref('rooms/' + roomId).set({
                players: {
                    player1: { avatar: player1Avatar, score: 0, answer: null },
                    player2: null
                },
                questionIndex: 0,
                quizLevel: 1
            });
            isOnlineMulti = true;
            alert('Kod bilik anda: ' + roomId);
            listenForOpponent(roomId, 'player1');
            startQuiz(1, 'multi');
        }

        function joinRoom() {
            roomId = document.getElementById('room-code').value.trim();
            if (!roomId) {
                alert('Sila masukkan kod bilik!');
                return;
            }
            database.ref('rooms/' + roomId).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    database.ref('rooms/' + roomId + '/players/player2').set({
                        avatar: player2Avatar,
                        score: 0,
                        answer: null
                    });
                    isOnlineMulti = true;
                    listenForOpponent(roomId, 'player2');
                    startQuiz(1, 'multi');
                } else {
                    alert('Bilik tidak wujud!');
                }
            });
        }

        function listenForOpponent(room, player) {
            database.ref('rooms/' + room).on('value', snapshot => {
                const data = snapshot.val();
                if (!data) return;
                if (data.players.player1 && data.players.player2) {
                    player1Avatar = data.players.player1.avatar;
                    player2Avatar = data.players.player2.avatar;
                    player1Score = data.players.player1.score;
                    player2Score = data.players.player2.score;
                    player1Answer = data.players.player1.answer;
                    player2Answer = data.players.player2.answer;
                    currentQuestion = data.questionIndex;
                    currentQuiz = data.quizLevel;
                    currentQuestions = quizData[currentQuiz];
                    if (player1Answer && player2Answer) {
                        checkMultiAnswers();
                    }
                    loadQuestion();
                }
            });
        }

        function startQuiz(quizNumber, mode) {
            currentQuiz = quizNumber;
            currentQuestions = quizData[quizNumber];
            gameMode = mode;
            currentQuestion = 0;
            player1Score = 0;
            player2Score = 0;
            player1Answer = null;
            player2Answer = null;
            document.getElementById('player1-score').innerText = '0';
            document.getElementById('player2-score').innerText = '0';
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('intro-page').style.display = 'none';
            document.getElementById('mode-page').style.display = 'none';
            document.getElementById('avatar-page').style.display = 'none';
            document.getElementById('room-page').style.display = 'none';
            document.getElementById('quiz-page').style.display = 'block';
            document.getElementById('congrats-page').style.display = 'none';
            document.getElementById('laugh-popup').style.display = 'none';
            loadQuestion();
        }

        // Quiz Logic
        function loadQuestion() {
            const q = currentQuestions[currentQuestion];
            document.getElementById('question').innerHTML = `<span class="question-icon">${q.icon}</span> ${q.question}`;
            const player1Options = document.getElementById('player1-options');
            const player2Options = document.getElementById('player2-options');
            const soloOptions = document.getElementById('solo-options');
            const playerSection = document.getElementById('player-section');
            player1Options.innerHTML = '';
            player2Options.innerHTML = '';
            soloOptions.innerHTML = '';
            player1Answer = null;
            player2Answer = null;

            document.getElementById('player1-header').innerHTML = `Pemain 1 <span class="player-avatar">${player1Avatar}</span> (Skor: <span id="player1-score">${player1Score}</span>)`;
            document.getElementById('player2-header').innerHTML = `Pemain 2 <span class="player-avatar">${player2Avatar}</span> (Skor: <span id="player2-score">${player2Score}</span>)`;

            if (gameMode === 'solo') {
                playerSection.style.display = 'none';
                soloOptions.style.display = 'block';
                document.getElementById('solo-avatar').innerText = player1Avatar;
                q.options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'option';
                    button.innerText = option;
                    button.onclick = () => checkSoloAnswer(option);
                    soloOptions.appendChild(button);
                });
            } else {
                playerSection.style.display = 'flex';
                soloOptions.style.display = 'none';
                document.getElementById('solo-avatar').innerText = '';
                q.options.forEach(option => {
                    const button1 = document.createElement('button');
                    button1.className = 'option';
                    button1.innerText = option;
                    button1.onclick = () => selectAnswer(1, option);
                    player1Options.appendChild(button1);

                    const button2 = document.createElement('button');
                    button2.className = 'option';
                    button2.innerText = option;
                    button2.onclick = () => selectAnswer(2, option);
                    player2Options.appendChild(button2);
                });
            }

            document.getElementById('question').style.display = 'flex';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('countdown').style.display = 'none';
            document.getElementById('result').style.display = 'none';
        }

        function checkSoloAnswer(selected) {
            const q = currentQuestions[currentQuestion];
            const feedback = document.getElementById('feedback');
            const countdown = document.getElementById('countdown');
            feedback.style.display = 'block';
            countdown.style.display = 'block';

            if (selected === q.answer) {
                feedback.innerText = "Yay! Betul! ðŸŽ‰";
                feedback.style.backgroundColor = '#e8f5e9';
                feedback.style.color = '#4caf50';
                player1Score++;
                correctSound.play();
            } else {
                feedback.innerText = `Alamak! Salah. Jawapan betul ialah "${q.answer}".`;
                feedback.style.backgroundColor = '#fce4ec';
                feedback.style.color = '#d81b60';
                wrongSound.play();
            }

            const buttons = document.querySelectorAll('#solo-options .option');
            buttons.forEach(button => button.disabled = true);

            let timeLeft = 5;
            countdown.innerText = timeLeft;
            const countdownInterval = setInterval(() => {
                timeLeft--;
                countdown.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    currentQuestion++;
                    if (currentQuestion < currentQuestions.length) {
                        loadQuestion();
                    } else {
                        showResult();
                    }
                }
            }, 1000);
        }

        function selectAnswer(player, selected) {
            if (isOnlineMulti) {
                database.ref(`rooms/${roomId}/players/player${player}/answer`).set(selected);
                database.ref(`rooms/${roomId}/players/player${player}/score`).set(player === 1 ? player1Score : player2Score);
            } else {
                if (player === 1) {
                    player1Answer = selected;
                    const buttons1 = document.querySelectorAll('#player1-options .option');
                    buttons1.forEach(button => {
                        button.disabled = true;
                        if (button.innerText === selected) {
                            button.style.backgroundColor = '#4caf50';
                        }
                    });
                } else {
                    player2Answer = selected;
                    const buttons2 = document.querySelectorAll('#player2-options .option');
                    buttons2.forEach(button => {
                        button.disabled = true;
                        if (button.innerText === selected) {
                            button.style.backgroundColor = '#4caf50';
                        }
                    });
                }
                if (player1Answer && player2Answer) {
                    checkMultiAnswers();
                }
            }
        }

        function checkMultiAnswers() {
            const q = currentQuestions[currentQuestion];
            const feedback = document.getElementById('feedback');
            const countdown = document.getElementById('countdown');
            feedback.style.display = 'block';
            countdown.style.display = 'block';

            let feedbackText = '';
            let scored = false;
            if (player1Answer === q.answer && player2Answer === q.answer) {
                feedbackText = "Yay! Kedua-dua betul! ðŸŽ‰";
                feedback.style.backgroundColor = '#e8f5e9';
                feedback.style.color = '#4caf50';
                player1Score++;
                player2Score++;
                scored = true;
                correctSound.play();
            } else if (player1Answer === q.answer) {
                feedbackText = `Pemain 1 betul, Pemain 2 salah. Jawapan betul: "${q.answer}".`;
                feedback.style.backgroundColor = '#fffde7';
                feedback.style.color = '#d81b60';
                player1Score++;
                scored = true;
                wrongSound.play();
            } else if (player2Answer === q.answer) {
                feedbackText = `Pemain 2 betul, Pemain 1 salah. Jawapan betul: "${q.answer}".`;
                feedback.style.backgroundColor = '#fffde7';
                feedback.style.color = '#d81b60';
                player2Score++;
                scored = true;
                wrongSound.play();
            } else {
                feedbackText = `Alamak! Kedua-dua salah. Jawapan betul: "${q.answer}".`;
                feedback.style.backgroundColor = '#fce4ec';
                feedback.style.color = '#d81b60';
                wrongSound.play();
            }

            feedback.innerText = feedbackText;
            document.getElementById('player1-score').innerText = player1Score;
            document.getElementById('player2-score').innerText = player2Score;

            if (isOnlineMulti && scored) {
                database.ref(`rooms/${roomId}/players/player1/score`).set(player1Score);
                database.ref(`rooms/${roomId}/players/player2/score`).set(player2Score);
                database.ref(`rooms/${roomId}/questionIndex`).set(currentQuestion + 1);
            }

            let timeLeft = 5;
            countdown.innerText = timeLeft;
            const countdownInterval = setInterval(() => {
                timeLeft--;
                countdown.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    player1Answer = null;
                    player2Answer = null;
                    if (isOnlineMulti) {
                        database.ref(`rooms/${roomId}/players/player1/answer`).set(null);
                        database.ref(`rooms/${roomId}/players/player2/answer`).set(null);
                    }
                    currentQuestion++;
                    if (currentQuestion < currentQuestions.length) {
                        loadQuestion();
                    } else {
                        showResult();
                    }
                }
            }, 1000);
        }

        function showResult() {
            document.getElementById('question').style.display = 'none';
            document.getElementById('player-section').style.display = 'none';
            document.getElementById('solo-options').style.display = 'none';
            document.getElementById('solo-avatar').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('countdown').style.display = 'none';

            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';

            if (gameMode === 'solo') {
                if (player1Score === currentQuestions.length) {
                    showCongrats();
                } else {
                    resultDiv.innerHTML = `Skor kamu: ${player1Score}/10.<br>Jangan putus asa, cuba lagi sampai dapat 10/10! ðŸ˜„<br><button class="cta-button" onclick="startQuiz(${currentQuiz}, 'solo')">Cuba Lagi</button>`;
                }
            } else {
                if (player1Score === currentQuestions.length && player2Score === currentQuestions.length) {
                    showCongrats();
                } else {
                    resultDiv.innerHTML = `Skor Pemain 1: ${player1Score}/10, Pemain 2: ${player2Score}/10.<br>Jangan putus asa, kedua-dua perlu dapat 10/10! ðŸ˜„<br><button class="cta-button" onclick="startQuiz(${currentQuiz}, 'multi')">Cuba Lagi</button>`;
                }
            }
        }

        function showCongrats() {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('intro-page').style.display = 'none';
            document.getElementById('mode-page').style.display = 'none';
            document.getElementById('avatar-page').style.display = 'none';
            document.getElementById('room-page').style.display = 'none';
            document.getElementById('quiz-page').style.display = 'none';
            document.getElementById('congrats-page').style.display = 'flex';
            document.getElementById('laugh-popup').style.display = 'none';
            const congratsTitle = document.getElementById('congrats-title');
            const congratsMessage = document.getElementById('congrats-message');
            const nextLevelBtn = document.getElementById('next-level-btn');

            if (gameMode === 'solo') {
                congratsTitle.innerText = "Tahniah! 10/10!";
                congratsMessage.innerText = "Kamu hebat! Semua soalan betul! ðŸŽ‰ Nak main tahap seterusnya?";
            } else {
                congratsTitle.innerText = "Tahniah! 10/10 Berdua!";
                congratsMessage.innerText = "Kamu berdua hebat! Semua soalan betul! ðŸŽ‰ Nak main tahap seterusnya?";
            }

            if (currentQuiz < 10) {
                nextLevelBtn.innerText = `Main Tahap ${currentQuiz + 1}!`;
                nextLevelBtn.onclick = () => {
                    if (isOnlineMulti) {
                        database.ref(`rooms/${roomId}/quizLevel`).set(currentQuiz + 1);
                        database.ref(`rooms/${roomId}/questionIndex`).set(0);
                        database.ref(`rooms/${roomId}/players/player1/score`).set(0);
                        database.ref(`rooms/${roomId}/players/player2/score`).set(0);
                    }
                    startQuiz(currentQuiz + 1, gameMode);
                };
            } else {
                nextLevelBtn.innerText = "Tahniah! Semua Tahap Selesai!";
                nextLevelBtn.onclick = () => showIntro();
            }
            cheerSound.play();
            startConfetti();
        }

        function goBack() {
            if (isOnlineMulti) {
                database.ref('rooms/' + roomId).remove();
                isOnlineMulti = false;
                roomId = null;
            }
            if (gameMode === 'solo') {
                showModeSelection();
            } else {
                showAvatarSelection('multi');
            }
        }

        function goHome() {
            if (isOnlineMulti) {
                database.ref('rooms/' + roomId).remove();
                isOnlineMulti = false;
                roomId = null;
            }
            showIntro();
        }

        // Confetti Animation
        function startConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const confetti = [];
            const colors = ['#ffeb3b', '#4caf50', '#d81b60', '#2196f3', '#ff9800'];

            for (let i = 0; i < 100; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    r: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    speed: Math.random() * 5 + 2,
                    angle: Math.random() * 360
                });
            }

            function animateConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                confetti.forEach(c => {
                    c.y += c.speed;
                    c.x += Math.sin(c.angle) * 0.5;
                    c.angle += 0.1;

                    if (c.y > canvas.height) {
                        c.y = -c.r;
                        c.x = Math.random() * canvas.width;
                    }

                    ctx.beginPath();
                    ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
                    ctx.fillStyle = c.color;
                    ctx.fill();
                });
                requestAnimationFrame(animateConfetti);
            }

            animateConfetti();
        }
    </script>
</body>
</html>
